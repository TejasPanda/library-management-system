<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <title>Borrowed Books - Admin</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #0d0b14;
            color: #fff;
            font-family: "Segoe UI", sans-serif;
        }

        .admin-card {
            background: rgba(98, 0, 234, 0.15);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(150, 80, 255, 0.3);
            box-shadow: 0 0 20px rgba(150, 80, 255, 0.25);
        }

        .table-header {
            font-weight: bold;
            color: #c084fc;
        }

        .overdue {
            color: #ff6b6b;
            font-weight: bold;
        }

        .returned {
            color: #4ade80;
            font-weight: bold;
        }
    </style>
</head>

<body>

<div th:replace="~{navbar-admin :: navbar}"></div>

<div class="container mt-4">

    <h2 class="fw-bold mb-4">Borrowed Books (Admin View)</h2>

    <div class="admin-card">
        <form method="get" action="/ui/admin/borrows"
              class="mb-4 d-flex gap-2 align-items-center">

            <label class="fw-bold">Filter:</label>

            <select name="filter" class="form-select w-auto">
                <option value="ALL" th:selected="${filter == 'ALL'}">All</option>
                <option value="BORROWED" th:selected="${filter == 'BORROWED'}">Borrowed</option>
                <option value="OVERDUE" th:selected="${filter == 'OVERDUE'}">Overdue</option>
                <option value="RETURNED" th:selected="${filter == 'RETURNED'}">Returned</option>
            </select>

            <button class="btn btn-primary">Apply</button>
        </form>


        <table class="table table-dark table-hover align-middle">

            <thead>
            <tr class="table-header">
                <th>User</th>
                <th>Book</th>
                <th>Borrowed At</th>
                <th>Due Date</th>
                <th>Status</th>
            </tr>
            </thead>

            <tbody>

            <tr th:each="r : ${borrowedRecords}">
                <!-- User -->
                <td th:text="${r.user.username}"></td>

                <!-- Book -->
                <td th:text="${r.book.bookName}"></td>

                <!-- Borrowed At -->
                <td th:text="${#temporals.format(r.borrowedAt, 'dd MMM yyyy, hh:mm a')}"></td>

                <!-- Due Date -->
                <td th:text="${#temporals.format(r.dueDate, 'dd MMM yyyy')}"
                    th:classappend="${r.dueDate.toLocalDate().isBefore(T(java.time.LocalDate).now())} ? 'overdue' : ''">
                </td>

                <!-- Status -->
                <td>
                    <!-- Returned -->
                    <span th:if="${r.status.name() == 'RETURNED'}" class="returned">
                        Returned
                    </span>

                    <!-- Borrowed -->
                    <span th:if="${r.status.name() == 'BORROWED'}">
                        <span th:if="${r.dueDate.toLocalDate().isBefore(T(java.time.LocalDate).now())}"
                              class="overdue">
                            Overdue
                        </span>

                        <span th:unless="${r.dueDate.toLocalDate().isBefore(T(java.time.LocalDate).now())}">
                            Borrowed
                        </span>
                    </span>
                </td>
            </tr>

            </tbody>

        </table>

    </div>

</div>

</body>
</html>
