<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Books</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background-color: #121212;
            color: #ffffff;
        }

        .book-card {
            background: #1d1d1d;
            border-radius: 12px;
            padding: 20px;
            transition: 0.2s;
            border: 1px solid #2a2a2a;
        }

        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0px 0px 15px rgba(0, 150, 255, 0.4);
        }

        .badge {
            padding: 6px 10px;
            border-radius: 6px;
        }

        .search-box input {
            background: #1d1d1d;
            border: 1px solid #333;
            color: white;
        }

        .search-box button {
            background-color: #0d6efd;
        }
    </style>
</head>

<body>

<!-- NAVBAR -->
<div th:replace="~{navbar :: navbar}"></div>

<div class="container">

    <h2 class="mb-4 fw-bold">Browse Books</h2>

    <!-- ðŸ” SEARCH + SORT BAR -->
    <div class="d-flex flex-wrap align-items-center gap-3 mb-4">

        <!-- Search by Title -->
        <form method="get" action="/ui/books/search/title" class="d-flex search-box flex-grow-1">
            <input class="form-control me-2" type="search" placeholder="Search by Title" name="bookName">
            <button class="btn btn-primary">Search</button>
        </form>

        <!-- Search by Author -->
        <form method="get" action="/ui/books/search/author" class="d-flex search-box flex-grow-1">
            <input class="form-control me-2" type="search" placeholder="Search by Author" name="authorName">
            <button class="btn btn-secondary">Search</button>
        </form>

        <!-- Sort Dropdown -->
        <form method="get" action="/ui/books" class="d-flex">
            <select name="sort" class="form-select me-2">
                <option value="bookName" th:selected="${sort == 'bookName'}">Title A-Z</option>
                <option value="authorName" th:selected="${sort == 'authorName'}">Author A-Z</option>
                <option value="isIssued" th:selected="${sort == 'isIssued'}">Availability</option>
                <option value="bookId" th:selected="${sort == 'bookId'}">Recently Added</option>
            </select>
            <button class="btn btn-info">Sort</button>
        </form>

    </div>


    <!-- BOOK LIST -->
    <div class="row" th:each="book : ${books}">
        <div class="col-md-4 mb-4">
            <div class="book-card">

                <h4 class="fw-bold" th:text="${book.bookName}"></h4>
                <p class="text-info mb-1" th:text="'Author: ' + ${book.authorName}"></p>

                <!-- STATUS BADGE -->
                <div>
                    <span th:if="${book.isIssued}" class="badge bg-danger">Issued</span>
                    <span th:unless="${book.isIssued}" class="badge bg-success">Available</span>
                </div>

                <div class="mt-3">

                    <!-- BORROW BUTTON -->
                    <a th:if="${!book.isIssued}"
                       th:href="@{/ui/books/borrow/{id}(id=${book.bookId})}"
                       class="btn btn-primary w-100 mb-2">
                        Borrow
                    </a>
                    <!-- ISSUED MESSAGE -->
                    <p th:if="${book.isIssued}"
                       class="text-warning fw-bold mt-2 text-center">
                        Currently unavailable
                    </p>



                </div>

            </div>
        </div>
    </div>

    <!-- PAGINATION -->
    <div class="d-flex justify-content-center mt-4">
        <nav>
            <ul class="pagination">
                <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/ui/books(page=${currentPage - 1}, sort=${sort})}">Previous</a>
                </li>

                <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages-1)}"
                    th:classappend="${i == currentPage} ? 'active'">
                    <a class="page-link"
                       th:text="${i + 1}"
                       th:href="@{/ui/books(page=${i}, sort=${sort})}"></a>
                </li>

                <li class="page-item" th:classappend="${currentPage + 1 >= totalPages} ? 'disabled'">
                    <a class="page-link"
                       th:href="@{/ui/books(page=${currentPage + 1}, sort=${sort})}">Next</a>
                </li>
            </ul>
        </nav>
    </div>

</div>

</body>
</html>
